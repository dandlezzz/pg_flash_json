#!/usr/bin/env ruby

require "bundler/setup"
require "pg_flash_json"
require 'active_record'
ActiveRecord::Base.establish_connection adapter: :postgresql, database: 'pg_flash_json_test', username: ENV['PG_DB_USERNAME'], password: ENV['PG_DB_PASSWORD']

class Post < ActiveRecord::Base
  has_many :comments
end

class Comment < ActiveRecord::Base
  belongs_to :post
end

def seed_data
  create_post_table  unless ActiveRecord::Migration.table_exists?(:posts)
  create_comment_table unless ActiveRecord::Migration.table_exists?(:comments)
  10.times do |i|
    post = Post.create!(title: "Post ##{i}", content: "some post content #{(i+2).to_s}")
    puts post.reload.content
    10.times {|ci| Comment.create(content: "comment content #{ci}", post_id: post.id)}
  end
end

def create_post_table
  ActiveRecord::Migration.create_table :posts do |t|
    t.string :title
    t.text :content
  end
end

def create_comment_table
  ActiveRecord::Migration.create_table :comments do |t|
    t.string :content
    t.integer :post_id
  end
end
# # You can add fixtures and/or initialization code here to make experimenting
# # with your gem easier. You can also use a different console, if you like.
#
# # (If you use this, don't forget to add pry to your Gemfile!)
# # require "pry"
# # Pry.start
#



require "irb"
IRB.start
